# os面试

### 进程

#### 进程通信方式？

1. 低级通信：P/V操作（信号量）
2. 共享存储：需要程序员对该区域管理
3. 消息传递
4. 管道通信
   是共享存储的优化发展，共享一个管道文件
   一个进程对管道读/写时，另一个进程等待；写满时阻塞，被读后唤醒，读空时阻塞，被写后唤醒
   - 无名管道：临时对象、父子进程通信
   - 有名管道：实体独享，任意进程通信

#### 进程调度？

- 先来先服务FCFS
  有利于长作业、不利于短作业，一般不单独使用
- 短作业优先
  有利于短作业；需要提前估计时间，不利于长作业可能导致饥饿，不能保证及时响应
- 优先级调度（剥夺/非剥夺）
  可以使紧迫任务及时执行；静态优先级可能导致饥饿，动态优先级开销大
- 高响应比优先（等待时间 / 要求服务时间+1）
  兼顾了短作业和长作业；增加了系统开销、不满足紧迫进程
- 时间片轮转调度
  时间片大小 = 系统对响应时间的要求 / 系统最大进程数目
  可保证及时响应；不利于短进程和IO繁忙型（IO繁忙可理解为短作业），不满足紧迫进程
- 多级反馈队列
  设置多个优先级队列（可抢占），高优先级队列时间片短，新进程首先进入一级队列，被剥夺后进入下一级队列，系统依次执行每个队列
  较好地协调了短进程和长进程、IO频繁进程和计算频繁进程

#### 线程

背景：为了处理基于同一数据区同时多个请求的问题

#### 进程与线程的区别？

- 进程是资源分配的基本单位，线程几乎不拥有资源，只拥有少量保证能独立运行的资源（PC、寄存器等）
- 进程不是独立运行的基本单位，线程是独立运行的基本单位
- 进程的调度是由操作系统完成，相对较慢。线程的切换可由操作系统或用户完成，比较快
- 属于同一进程的线程都可以并发执行，进程只有在多处理机系统中才能并发执行

#### 用户态线程与核心态线程？

用户态：

对于核心只是单线程进程，在一个线程管理系统上运行，

- 优点：可在不支持多线程的操作系统实现，速度很快，有自己的调度算法，灵活、可扩充

核心态：所有对线程的操作都以系统调用形式实现，速度较慢

- 优点：支持轮转式调度、线程被动放弃CPU，用户态线程只能主动放弃CPU

#### 进程间通信/同步？

锁机制（无法实现让权等待）、信号量、信号

#### 多线程vs多进程

- 需要频繁创建、销毁的工作用多线程
- 需要大量计算的用多线程
- 数据强相关处理用多线程、弱相关用进程

#### 死锁产生的必要条件

- 互斥条件：某一时刻某一资源仅为一个进程占有
- 不剥夺条件：进程的资源未使用完不能被剥夺
- 请求和保持条件：进程保持了至少一个资源又提出新的资源请求
- 循环等待条件：存在一条资源循环等待链，每个进程已获得资源又被下一个进程申请

#### 死锁处理策略

1. 死锁预防：防止必要条件发生
2. 死锁避免：资源分配时若无法进入安全状态则进程等待
   `安全状态`：系统能按照某种顺序推进所有进程并分配资源
   `银行家算法`：求系统安全状态序列
3. 死锁检测和解除
   检测：资源分配图中依次消去可满足的进程，若消去所有边则无死锁，否则死锁
   解除：资源剥夺（挂起进程并剥夺其资源）；撤销进程（kill）；进程回退（回退到不发生死锁的状态）

### 内存

#### 页面淘汰/置换算法

- 最佳淘汰算法：
  选择未来最长时间不使用页面淘汰（理想）
- 先进先出：
  用队列链接，有可能出现分配页面增加，缺页次数不增反降的Belady异常
- 最近最少使用（LRU）：
  每次选择`最久未访问`的页淘汰，是堆栈类算法、不易实现
- 最不经常使用（NFU）：
  选择上一次淘汰到这次淘汰时间内`被访问次数最少`的淘汰，更新计时器；
  需要给页表中的每一页加一个计数器
- 最近未使用（NUR）：
  从上一次淘汰到这一次淘汰时间内`未被使用`的页中任选一页淘汰，更新状态位；
  需要增设状态位：访问位和修改位，开销很小
  - 没访问没修改
  - 没访问有修改
  - 有访问没修改
  - 有访问有修改

NFU和NUR的不足都是无法区别这样两个页面：均为现在要淘汰的页面，一个在10周期以前访问过、一个在1000周期以前访问过，只能从中随机淘汰

#### 防止抖动现象

1. 选择好的淘汰算法
2. 扩大工作集：当进程置换页面时，把进程锁住，换出其他进程的页从而扩大工作集

### 文件

#### 文件共享

1. 硬链接
   目录项为同一个索引节点、索引节点维护一个count，count=0时删除文件
2. 软链接
   文件为LINK文件，文件的内容是被链接文件的路径

#### 文件实现/磁盘非空闲块管理

1. 连续分配
   文件连续存储，文件分配表中存储开始块号和长度
2. 隐式链接
   每个盘块中有指向下一块的指针
3. 显示链接
   把每个盘块的下一块盘号存储在一个文件分配表中，
   查找下一块工作可在内存中进行，减少读盘次数
4. 索引分配
   一个索引块/表中存储文件的所有盘块号，还可设多级索引以支持大文件
   Unix用混合索引（直接索引+一级索引+二级索引...）

#### 空闲块管理

1. 空闲表
   指明所有空闲区的第一块和长度，表可能很大，不适用大型文件系统
2. 空闲链表
   所有空闲块串成链表，可能多次调块，不适用大型文件系统
3. 位示图
   每个块用一位表示是否空闲，可用于大型系统
4. 成组链接
   递归定义：每个链接块链接n个块，最后一个块也为链接块（Unix）

#### 磁盘调度算法（寻道）

1. 先来先服务
2. 最短寻道时间优先
3. 扫描算法（SCAN）
4. 循环扫描（C-SCAN）

#### 系统启动

CPU从默认位置（固化在主板上的ROM）启动BIOS系统，BIOS把磁盘上第0扇区的自举程序加载到内存中执行，自举程序负责把操作系统装入并执行

#### SPOOLing技术

实现虚拟设备功能，将独占设备改造为共享设备，提高IO速度

输入设备：先将数据由输入设备输入到内存缓冲区再输入到磁盘缓冲井，CPU准备好时再将数据读入内存

输出设备：CPU先将要输出的数据从内存输出到磁盘输出井，IO设备准备好时将数据由输出井经过缓冲区输出到IO设备